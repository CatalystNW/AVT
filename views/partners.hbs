<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="/javascript/xedit.js" type="text/javascript"></script>

<style>
  button.btn.btn-primary.btn-sm.editable-submit {
    width: 35px;
    height: 35px;
  }

  button.btn.btn-primary.btn-sm.editable-submit:after {
    content:  "\2713 ";
    font-size: 24px;
  }

  button.btn.btn-default.btn-sm.editable-cancel {
    width: 35px;
    height: 35px;
  }
  button.btn.btn-default.btn-sm.editable-cancel:after {
    content:  "\2190 ";
    font-size: 24px;
  }
</style>

<!--        Btn: #addAssocPartners
        [ THIS = CURRENT PARTNERS ]     -->
<span name="currentPartnersViewSpan" style="display:block;">                   <!-- currentPartnersViewSpan -->
  <div class="col-sm-7">                              
      <h3 name="currentPartnersLabel" class="h3underline">1. List of Partners</h3>
        <thead> 
            <th class="col-sm-7"><button onclick="addAssocPartnersBtn()" name="accessAssocPartners" class="accessAssocPartners btn btn-info">Modify Partners for this Project</button></th>
        </thead>
  </div>
</span>

<!-- ->     Btn: #addNEWtoDB      -> Btn: GO BACK to  [  CURRENT PARTNERS ]  
        [ THIS = addAssocPartners ]   (all partners but as a checklist - where associated ones are pre-selected. ). -->
<span name="addAssocPartners" style="display:none;">                 
  <div>                                                                         <!-- addAssocPartners -->
      <h3 name="newAssignLabel" class="h3underline">2. Assign Partners to this Project:</h3>
        <thead> 
            <th><button onclick="assocSaveBtn('submit')" name="assocSave" class="assocSave btn btn-success">Assign selected Partners to this Project</button></th>
            <th><button onclick="assocSaveBtn()" name="assocCancel" class="assocCancel btn btn-cancel">Cancel</button>
            <label class="assocSaveBtnLabel">Not in list?  <button onclick="assocSaveBtn('goToSpanThree')" name="goToNewDbBtn" class="goToNewDbBtn btn btn-info">ADD/REMOVE PARTNERS DB</button></label>
        </thead>
  </div>
</span>


<!--          Btn: GO BACK to {{addAssocPartners}}  - TOGGLE BETWEEN THE TWO
        [ THIS = addNEWtoDB ]    -->
<span name="addNEWtoDB" style="display:none;">                                 <!-- addNEWtoDB -->
 <!--  <div class="row"> -->
    <div class="col-xs-12">
      <h3 name="globalPartnersLabel" class="h3underline">3. Global Partners List</h3>

  <!--     <div class="row">
        <div class="col-xs-12 col-sm-6"> -->
          <table id="buttonTable" name="buttonTable" style="display:block;">
          <h4 name="newPartnerLabel" style="display:none;">Adding NEW Partner</h4>
            <thead> 
                <th class="col-sm-7"><button onclick="createPartnerBtnPressed()" name="createPartner" class="createPartnerBtn btn btn-success">Add New Partner</button></th>
                <th class="col-sm-4"><button onclick="removePartnerBtnPressed()" name="removePartner" class="removePartnerBtn btn btn-warning">Remove Partners</button></th>
            </thead>
          </table>

          <span name="formSpan" style="display:none;">
            <div>
                <form class="form-inline editableform" style="">
                  <div class="control-group form-group">
                    <!-- <div class="editable-input"> -->
                      <!-- <select type="radio" class="form-control input-sm"> -->  <!-- <option value="projectCompleted">Project - Completed</option> -->
                      <label class="partnerAddTextLabel"><strong>Organization:</strong>
                        <input required name="create_org_name" type="text" class="form-control input-sm" style="padding-left: 10px;margin-left: 50px;"></label><br>
                      <label class="partnerAddTextLabel"><strong>Address:</strong>
                        <input name="create_org_address" type="text" class="form-control input-sm" style="padding-left: 10px;margin-left: 85px;"></label><br>
                      <label class="partnerAddTextLabel"><strong>Contact Name:</strong>
                        <input name="create_contact_name" type="text" class="form-control input-sm" style="padding-left: 10px;margin-left: 40px;"></label><br>
                      <label class="partnerAddTextLabel"><strong>Contact Phone:</strong>
                        <input name="create_contact_phone" type="text" class="form-control input-sm" style="padding-left: 10px;margin-left: 35px;"></label><br>
                      <label class="partnerAddTextLabel"><strong>Contact Email:</strong>
                        <input name="create_contact_email" type="text" class="form-control input-sm" style="padding-left: 10px;margin-left: 40px;"></label><br>

                    <div class="editable-buttons">
                        <!-- <div name="createPartnerSpinning" class="editableform-loading" style="display: none;"></div> -->
                        <button onsubmit="createPartnerSubmitBtn()" name="submitAddPartnerBtn" class="btnCheckmark btn btn-primary btn-sm editable-submit">
                          <i class="glyphicon glyphicon-ok"></i>
                        </button>
                        <button onclick="discardPartnerFormBtnPressed()" name="cancelAddPartnerBtn" class="btnBackArrow btn btn-default btn-sm editable-cancel">
                          <i class="glyphicon glyphicon-remove"></i>
                        </button>
                    </div>
                  
                </div>
              </form>
            </div>
          </span>

          <table class="table">
            <thead> 
                  <th class="col-sm-4">Organization</th>
                  <th class="col-sm-7">Information</th>
            </thead> 
            <tbody>
                
                {{#if results}}
                  {{#each results.partner}}
                    <div class="{{_id}}" name="{{_id}}">
                      <tr class="{{_id}}" name="{{_id}}">
                        <th class="col-sm-4" name="{{_id}}">{{org_name}}</th>
                          <td class="col-sm-7" name="{{_id}}"><strong>{{org_address}}</strong></td>
                      </tr>
                      
                      <tr class="{{_id}}" name="{{_id}}">
                        <th class="col-sm-4" name="{{_id}}">
                          <button name="removeThisPartner" style="display:none;" class="btn btn-danger btn-sm" id="{{_id}}" onclick="removeThisBtn('{{_id}}')">Remove this</button>
                        </th>
                          <td class="col-sm-7" name="{{_id}}">Contact: {{contact_name}}</td>
                      </tr>

                      <tr>
                        <th class="col-sm-4" name="{{_id}}"></th>
                          <td class="col-sm-7" name="{{_id}}">Phone: <a href="tel:{{contact_phone}}">{{contact_phone}}</a></td>
                      </tr>

                      <tr>
                        <th class="col-sm-4" name="{{_id}}"></th>
                          <td class="col-sm-7" name="{{_id}}">Email: <a href="mailto:{{contact_email}}">{{contact_email}}</a></td>
                      </tr>
                    </div>
                  {{/each}}
                {{/if}}

            </tbody>
          </table>
                        <!-- <td class="col-sm-9"><select>Select from list...</select></td> -->
                      <!-- <h5>Status: <a href="#" id="status" data-type="select" data-pk="{{_id}}" data-url="/edit/{{_id}}" data-name="status" data-title="Select status"></a></h5> -->
                   

     <!--     contact_email: 'sales@homedepot.ca',
         __v: 0 },
       { _id: 5bf37f5ea46e13b89102d8f8,
         org_name: 'Rona Home Improvement',
         org_address: '2399 Derry Rd E, Toronto, ON',
         contact_name: 'Mike Anderson',
         contact_phone: '(647) 384 2342',
         contact_email: 'info@rona.ca', -->

    <!-- </div> -->
  </div>

<script src="/javascript/searchYear.js" type="text/javascript"></script>
<!-- Make entire table rows clickable! -->
<script>

    function removePartnerBtnPressed() {
        var eachBtn = document.getElementsByName("removeThisPartner");
        var mainBtn = document.getElementsByName("removePartner");
        var createBtn = document.getElementsByName("createPartner");

        for (var i = 0; i < eachBtn.length; i++) {
            if (eachBtn[i].style.display === "none") {
                eachBtn[i].style.display = "block";
                
                mainBtn[0].className = "btn btn-cancel";
                mainBtn[0].innerText = "Done";
                mainBtn[0].style.paddingLeft  = "58px";
                mainBtn[0].style.paddingRight = "59px";

                createBtn[0].disabled = true;

            } else {
                eachBtn[i].style.display = "none";
                  mainBtn[0].className = "btn btn-warning";
                  mainBtn[0].innerText = "Remove Partners";
                  mainBtn[0].style.padding = ".5rem 1rem";
                createBtn[0].disabled = false;
              // mainBtn.style.marginLeft = '10px';
              // mainBtn.style.paddingRight = '10px';
            }
        }
    }


    function addAssocPartnersBtn() {                                                  //First BUTTON
        //Toggle Partner DB and Other Span View 
        var firstSpan  = document.getElementsByName("currentPartnersViewSpan");
        var secondSpan = document.getElementsByName("addAssocPartners");

        // var addNEWtoDB      = document.getElementsByName("addNEWtoDB");

        if (firstSpan[0].style.display === "none") {
            firstSpan[0].style.display = "block";
            secondSpan[0].style.display = "none";
        } else {
            firstSpan[0].style.display = "none";
            secondSpan[0].style.display = "block";
            // mainBtn[0].innerText = "Done";
        }
    }

    function assocSaveBtn(inSubmit) {                                               //Second BUTTON(S)
        if (inSubmit === 'submit') {   //Assign selected - Submit POST
            alert("Submit Pressed");
        } else if (inSubmit === 'goToSpanThree') {        //Show Global List (Span #3)
            var secondSpan = document.getElementsByName("addAssocPartners");
            var thirdSpan  = document.getElementsByName("addNEWtoDB");

            secondSpan[0].style.display = "none";
            thirdSpan[0].style.display = "block";

        } else {                                          //Cancel Button - will not submit anything
            window.location.reload(true);
        }
    }


    function createPartnerBtnPressed() {                                                //Third BUTTON
        var buttonTable = document.getElementsByName("buttonTable");
        var newPartnerLabel = document.getElementsByName("newPartnerLabel");
        var formSpan = document.getElementsByName("formSpan");

        buttonTable[0].style.display = "none";
        newPartnerLabel[0].style.display = "block";
        formSpan[0].style.display = "block";
    }


    function discardPartnerFormBtnPressed() {
        var buttonTable = document.getElementsByName("buttonTable");
        var newPartnerLabel = document.getElementsByName("newPartnerLabel");
        var formSpan = document.getElementsByName("formSpan");

        buttonTable[0].style.display = "block";
        newPartnerLabel[0].style.display = "none";
        formSpan[0].style.display = "none";
    }

    function createPartnerSubmitBtn() {

        var sendData =  {
                  org_name:      document.getElementsByName("create_org_name")[0].value,
                  org_address:   document.getElementsByName("create_org_address")[0].value,
                  contact_name:  document.getElementsByName("create_contact_name")[0].value,
                  contact_phone: document.getElementsByName("create_contact_phone")[0].value,
                  contact_email: document.getElementsByName("create_contact_email")[0].value,
        };

        var buttonTable = document.getElementsByName("buttonTable");
        var newPartnerLabel = document.getElementsByName("newPartnerLabel");
        var formSpan = document.getElementsByName("formSpan");

        buttonTable[0].style.display = "none";
        newPartnerLabel[0].style.display = "block";
        formSpan[0].style.display = "block";


        xhr(sendData, 'POST', '/partners/createPartner', function(err) {
            if (err) {
                alert('Value did not save, please reload the page');
            }
            else {
                //BUTTON STUFF
                    // <table name="buttonTable" style="display:block;">
                    // <h3 name="newPartnerLabel" style="display:none;">Adding NEW Partner</h3>
                    // <span name="formSpan" style="display:none;">


                buttonTable[0].style.display = "block";

            }
        })

    }

    function removeThisBtn(remId) {
        var sendData = {_id: remId};
        xhr(sendData, 'POST', '/partners/deletePartner', function(err) {
            if (err) {
                alert('Value did not save, please reload the page');
            }
            else {
                while (document.getElementsByName(remId).length !== 0) {
                   document.getElementsByName(remId)[0].remove();
                }
            }
        })
    }

    function xhr(data, method, url, next) {
      //post to database
      var posting = $.ajax({
        type : method,
        url : url,
        dataType : 'json',
        contentType : 'application/json; charset=UTF-8',
        data : JSON.stringify(data)
      });

      // alert('xhr function called...');

      //check for error
      posting.done(function (xhr) {
        if(xhr.status === 'success' || xhr.status === 200 || xhr.status ==='200') {
          next(null, xhr)
        } else {
          next(new Error('Could not complete xhr'))
        }
      });

      posting.fail(function (res) {
        next(new Error('Could not complete xhr'))
      });
    }


    jQuery(document).ready(function($) {
        $(".clickable-row").click(function() {
            window.location = $(this).data("href");
        });
    });
</script>

<style type="text/css">
  .bg-pink {
    background-color: #ff72b3;
  }
  .dataRow {
    background-color: #ff72b3 !important;
  }

  .assocSaveBtnLabel {
    margin-left:50px;
    font-weight: 600;
  }
  .accessAssocPartners, .assocSave {
    margin-left: 1rem;
  }

  .partnerAddTextLabel {
    margin-left: 30px;
  }

  .btnCheckmark {
    margin-left: 180px;
  }

  table[name=buttonTable] {
    margin-bottom:20px;
  }
  
  .h3underline {
    margin-bottom:20px;
    text-decoration: underline;
  }

  
</style>
