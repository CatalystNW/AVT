<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="/javascript/xedit.js" type="text/javascript"></script>

<style>
  button.btn.btn-primary.btn-sm.editable-submit {
    width: 35px;
    height: 35px;
  }

  button.btn.btn-primary.btn-sm.editable-submit:after {
    content:  "\2713 ";
    font-size: 24px;
  }

  button.btn.btn-default.btn-sm.editable-cancel {
    width: 35px;
    height: 35px;
  }
  button.btn.btn-default.btn-sm.editable-cancel:after {
    content:  "\2190 ";
    font-size: 24px;
  }
</style>

<!-- <div class="row"> -->
  <!-- <div class="col-xs-12"> -->
    <h5>Global Partners List</h5>

    <div class="row">
      <div class="col-xs-12 col-sm-6">
        <table style="margin-bottom:20px;">
          <thead> 
              <th class="col-sm-7"><button name="createPartner" class="btn btn-success">Add New Partner</button></th>
              <th class="col-sm-4"><button name="removePartner" class="btn btn-warning" onclick="showRemoveButtons()">Remove Partners</button></th>
          </thead>
        </table>

        <table class="table">
          <thead> 
                <th class="col-sm-4">Organization</th>
                <th class="col-sm-7">Information</th>
          </thead> 
          <tbody>
              
              {{#if results}}
                {{#each results.partner}}
                  <div class="{{_id}}" name="{{_id}}">
                    <tr class="{{_id}}" name="{{_id}}">
                      <th class="col-sm-4" name="{{_id}}">{{org_name}}</th>
                        <td class="col-sm-7" name="{{_id}}"><strong>{{org_address}}</strong></td>
                    </tr>
                    
                    <tr class="{{_id}}" name="{{_id}}">
                      <th class="col-sm-4" name="{{_id}}">
                        <button name="removeThisPartner" style="display:none;" class="btn btn-danger btn-sm" id="{{_id}}" onclick="removeThisBtn('{{_id}}')">Remove this</button>
                      </th>
                        <td class="col-sm-7" name="{{_id}}">Contact: {{contact_name}}</td>
                    </tr>

                    <tr>
                      <th class="col-sm-4" name="{{_id}}"></th>
                        <td class="col-sm-7" name="{{_id}}">Phone: <a href="tel:{{contact_phone}}">{{contact_phone}}</a></td>
                    </tr>

                    <tr>
                      <th class="col-sm-4" name="{{_id}}"></th>
                        <td class="col-sm-7" name="{{_id}}">Email: <a href="mailto:{{contact_email}}">{{contact_email}}</a></td>
                    </tr>
                  </div>
                {{/each}}
              {{/if}}

          </tbody>
        </table>
                      <!-- <td class="col-sm-9"><select>Select from list...</select></td> -->
                    <!-- <h5>Status: <a href="#" id="status" data-type="select" data-pk="{{_id}}" data-url="/edit/{{_id}}" data-name="status" data-title="Select status"></a></h5> -->
                 

   <!--     contact_email: 'sales@homedepot.ca',
       __v: 0 },
     { _id: 5bf37f5ea46e13b89102d8f8,
       org_name: 'Rona Home Improvement',
       org_address: '2399 Derry Rd E, Toronto, ON',
       contact_name: 'Mike Anderson',
       contact_phone: '(647) 384 2342',
       contact_email: 'info@rona.ca', -->

    </div>    
  </div>
</div>

<script src="/javascript/searchYear.js" type="text/javascript"></script>
<!-- Make entire table rows clickable! -->
<script>
    function showRemoveButtons() {
        var eachBtn = document.getElementsByName("removeThisPartner");
        var mainBtn = document.getElementsByName("removePartner");
        for (var i = 0; i < eachBtn.length; i++) {
            if (eachBtn[i].style.display === "none") {
                eachBtn[i].style.display = "block";
                mainBtn[0].className = "btn btn-cancel";
                mainBtn[0].innerText = "Cancel Changes";
            } else {
                eachBtn[i].style.display = "none";
                mainBtn[0].className = "btn btn-warning";
                mainBtn[0].innerText = "Remove Partners";
              // mainBtn.style.marginLeft = '10px';
              // mainBtn.style.paddingRight = '10px';
            }
        }
    }


    function removeThisBtn(remId) {
        // var data = {}, id = false
        // $('input, textarea', node).each(function(idx) {
        //   var path = this.name.split('.')[1]
        //   data[path] = this.value
        //   if (!id) id = this.name.split('.')[0]
        // })

        // XHR here
        //var xhrData = JSON.parse(JSON.stringify(data))
        //xhrData.id = id
        var sendData = {_id: remId};
        xhr(sendData, 'POST', '/partners/deletePartner', function(err) {
            if (err) {
                alert('Value did not save, please reload the page');
            }
            else {
                var hideDeleted = document.getElementsByClassName(remId);
                hideDeleted[0].style.display = "none";
                var arrLen = document.getElementsByName("5bf46c83f77af5c8ac4a7777").length;

                while (document.getElementsByName(remId).length !== 0) {
                   document.getElementsByName(remId)[0].remove();
                }

                //document.getElementsByName(remId).remove();
                // for (var i=0; i<workItems.length; i++) {
                //   if (workItems[i]._id === id) {
                //     Object.keys(data).forEach(function(k) {
                //       workItems[i][k] = data[k]
                //     })

                //     showWorkItem(workItems[i], node)
                //     //$('.work-items-comment').toggle();
                //   }
                // }
            }
        })
    }

    function xhr(data, method, url, next) {
      //post to database
      var posting = $.ajax({
        type : method,
        url : url,
        dataType : 'json',
        contentType : 'application/json; charset=UTF-8',
        data : JSON.stringify(data)
      });

      alert('xhr function called... TRIED POST');

      //check for error
      posting.done(function (xhr) {
        if(xhr.status === 'success' || xhr.status === 200 || xhr.status ==='200') {
          next(null, xhr)
        } else {
          next(new Error('Could not complete xhr'))
        }
      });

      posting.fail(function (res) {
        next(new Error('Could not complete xhr'))
      });
    }


    jQuery(document).ready(function($) {
        $(".clickable-row").click(function() {
            window.location = $(this).data("href");
        });
    });
</script>

<style type="text/css">
  .bg-pink {
    background-color: #ff72b3;
  }
  .dataRow {
    background-color: #ff72b3 !important;
  }
</style>
